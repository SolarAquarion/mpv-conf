
#SVP support for those who have it (https://www.svp-team.com/wiki/Main_Page)

# use this to detect auto-options malfunctions
x11-bypass-compositor=never

#########
# Cache #
#########

cache=auto
cache-default=16000                     # size in KB
cache-backbuffer=16000                  # size in KB
#cache-initial=1000                         # start playback when your cache is filled up with x kB
#cache-seek-min=2000
#cache-secs=30                            # how many seconds of audio/video to prefetch if the cache is active
cache-file=TMP
cache-file-size=8000000
# mpv plugin for caching live streams robust against network glitches without lengthening initial cache fill up period. (source https://github.com/lvml/mpv-plugin-streamcache)
script=/etc/mpv/scripts/streamcache.lua   



hls-bitrate=max # use max quality for HLS streams

#Aspect Moniteur [ 1280:1024 = 1.25 = 5:4; != 4:3 ;) ]
#monitoraspect = 5:4
### 1280:800 = 1.6 = 16:10
#monitoraspect = 16:10
### 1920:1080 = 16:9
monitoraspect = 16:9
#video-aspect=16:9
autofit-larger=50%x50%

# Helps play back UHDTV HEVC
vd-lavc-threads=16

#Interlaced video shows ugly comb-like artifacts, which are visible on fast movement
deinterlace=auto

# Replacement for quvi. Always use 1080p+ or 60 fps where available. Prefer VP9
# over AVC and VP8 for high-resolution streams.
ytdl=yes
ytdl-format=(bestvideo[ext=webm]/bestvideo[height>1080]/bestvideo[container-fps=60])[tbr<13000]+(bestaudio[acodec=opus]/bestaudio[ext=webm]/bestaudio)/best
hls-bitrate=max                         # use max quality for HLS streams

#########
# Audio #
#########

audio-file-auto=fuzzy                   # external audio doesn't has to match the file name exactly to autoload
audio-pitch-correction=yes              # automatically insert scaletempo when playing with higher speed
volume-max=130                         # maximum volume in %, everything above 100 results in amplification
volume=90                               # default volume, 100 = unchanged
audio-channels = stereo
audio-normalize-downmix=yes


# DTS-MA decoding
ad=lavc:libdcadec
# Output some video stats
term-playing-msg='Resolution: ${width}x${height}, Framerate: ${container-fps} Hz'


# Higher quality screenshots
screenshot-format=png
screenshot-png-compression=8
screenshot-tag-colorspace=yes
screenshot-directory=~/Pictures
screenshot-high-bit-depth=yes
screenshot-template=~/Pictures/%F-%P-shot-%04n


#############
# Languages #
#############

slang=eng,en,enUS,en-US                   # automatically select these subtitles (decreasing priority)
alang=jpn,jp,eng,en,enUS,en-US     # automatically select these audio tracks (decreasing priority)
ytdl-raw-options=sub-lang="en,eng,enUS,en-US",write-sub=


keep-open # keep the player open when a file's end is reached

# Colors!
msg-color=yes

#############
# OSD / OSC #
#############
osd-level=1                             # enable osd and display --osd-status-msg on interaction
osd-duration=2500                       # hide the osd after x ms
osd-status-msg='${time-pos} / ${duration}${?percent-pos:　(${percent-pos}%)}${?vo-drop-frame-count:${!vo-drop-frame-count==0:　Dropped: ${vo-drop-frame-count}}}\n${?chapter:Chapter: ${chapter}}'

osd-font='Source Sans Pro'
osd-font-size=32
osd-color='#CCFFFFFF'                   # ARGB format
osd-border-color='#DD322640'            # ARGB format
#osd-shadow-offset=1                    # pixel width for osd text and progress bar
osd-bar-align-y=0                       # progress bar y alignment (-1 top, 0 centered, 1 bottom)
osd-border-size=2                       # size for osd text and progress bar
osd-bar-h=2                             # height of osd bar as a fractional percentage of your screen height
osd-bar-w=60                            # width of " " "

#############
# Subtitles #
#############

demuxer-mkv-subtitle-preroll            # try to correctly show embedded subs when seeking
sub-auto=fuzzy                          # external subs don't have to match the file name exactly to autoload
sub-paths=ass:srt:sub:subs:subtitles    # search for external subs in the listed subdirectories
embeddedfonts=yes                       # use embedded fonts for SSA/ASS subs
sub-ass-force-style=Kerning=yes             # allows you to override style parameters of ASS scripts

# the following options only apply to subtitles without own styling (i.e. not ASS but e.g. SRT)
sub-font="Source Sans Pro Semibold"
sub-font-size=36
sub-color="#FFFFFFFF"
sub-border-color="#FF262626"
sub-border-size=3.2
sub-shadow-offset=1
sub-shadow-color="#33000000"
sub-spacing=0.5

################
# Video Output #
################

# Active VOs (and some other options) are set conditionally
# See here for more information: https://github.com/wm4/mpv-scripts/blob/master/auto-profiles.lua
# The script was slightly modified, functions from scripts/auto-profiles-functions.lua are imported

# Defaults for all profiles
vo=opengl
tscale=linear


[high-quality]
profile-desc=cond:is_desktop() and get('width', math.huge) < 3840
scale=ewa_lanczossharp
cscale=ewa_lanczossoft
dscale=mitchell
scale-antiring=0.7
cscale-antiring=0.7
dither-depth=auto
correct-downscaling=yes
sigmoid-upscaling=yes
deband=yes

[medium-quality]
profile-desc=cond:(is_laptop() and not on_battery() and get('width', math.huge) < 1920) or (is_desktop() and get('width', math.huge) >= 3840)
scale=spline36
cscale=bilinear
dscale=mitchell
scale-antiring=1.0
cscale-antiring=1.0
dither-depth=auto
correct-downscaling=yes
sigmoid-upscaling=yes
deband=yes

[SmoothVideo]
profile-desc=cond:(is_laptop() and not on_battery() and get('width', math.huge) < 1920) or (is_desktop() and get('width', math.huge) >= 3840)
scale=ewa_lanczossharp
cscale=ewa_lanczossoft
dscale=mitchell
tscale=triangle
scale-antiring=0.8
cscale-antiring=0.9
dither-depth=auto
correct-downscaling=yes

[NVDEC]
profile-desc=cond:(is_laptop() and not on_battery() and get('width', math.huge) < 1920) or (is_desktop() and get('width', math.huge) >= 3840)
scale=ewa_lanczossharp
cscale=ewa_lanczossoft
dscale=mitchell
tscale=triangle
scale-antiring=0.8
cscale-antiring=0.9
dither-depth=auto
correct-downscaling=yes


[low-quality]
profile-desc=cond:is_laptop() and (on_battery() or get('width', math.huge) >= 1920)
scale=bilinear
cscale=bilinear
dscale=bilinear
scale-antiring=0.0
cscale-antiring=0.0
dither-depth=no
correct-downscaling=no
sigmoid-upscaling=no
deband=no


[60FPS]
profile-desc=cond:is_laptop() and get('container-fps', 0) >= 59
scale=bilinear
cscale=bilinear

[4K]
profile-desc=cond:get('width', -math.huge) >= 3840
vd-lavc-threads=32

[4K-inverted]
profile-desc=cond:get('width', -math.huge) < 3840
vd-lavc-threads=0


[extension.gif]
cache=no
no-pause
loop-file=yes

[extension.webm]
cache=no
no-pause
loop-file=yes

stop-screensaver = yes

opengl-swapinterval=1
opengl-es=yes

################
# Video Output # active VOs (and some other options) are set externally by a script
################

# - gamma: 1.961/x = output gamma => 1.961/0.9338 = 2.1 (mpv assumes 1.961 gamma internally)
# - zeros for jinc() function: (scale-radius for ewa_lanczos)
#     3.2383154841662362 4.2410628637960699 5.2427643768701817 ... 8.2453949139520427 ...
# - target-prim=bt.2020 || icc-profile-auto



#vf add crop=512:512:64:64 #vf-clr
#/usr/share/color/icc/BT.709_Profiles/BT.709.icc
## - extra general settings, mostly video
vo=backend=auto:es=yes:sdl=switch-mode:scaling=hq:composite-detect:framedrop=vo
save-position-on-quit
#vf-add=vdpaupp=sharpen=0.10:denoise=0.10:deint=yes:deint-mode=temporal-spatial:pullup:hqscaling=1
